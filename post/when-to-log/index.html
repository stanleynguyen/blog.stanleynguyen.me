<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script type=application/javascript src=https://blog.stanleynguyen.me/js/theme-mode.js></script>
<link rel=stylesheet href=https://blog.stanleynguyen.me/css/frameworks.min.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/github.min.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/github-style.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/light.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/dark.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/syntax.css><title>To log, or not to log, that is the question. - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast</title><link rel=icon type=image/x-icon href=https://blog.stanleynguyen.me/images/favicon.ico><meta name=theme-color content="#1e2327"><meta name=description content="An alternative logging strategy to make loggers your friends, not enemies"><meta name=keywords content="logging,devops,architecture,observability,reliability,productivity,code quality"><meta name=robots content="noodp"><link rel=canonical href=https://blog.stanleynguyen.me/post/when-to-log/><meta name=twitter:card content="summary"><meta name=twitter:title content="To log, or not to log, that is the question. - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta name=twitter:description content="An alternative logging strategy to make loggers your friends, not enemies"><meta name=twitter:site content="https://blog.stanleynguyen.me/"><meta name=twitter:creator content="stanleynguyen"><meta name=twitter:image content="https://blog.stanleynguyen.me/post/when-to-log/img/shakespeare.jpg"><meta property="og:type" content="article"><meta property="og:title" content="To log, or not to log, that is the question. - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta property="og:description" content="An alternative logging strategy to make loggers your friends, not enemies"><meta property="og:url" content="https://blog.stanleynguyen.me/post/when-to-log/"><meta property="og:site_name" content="To log, or not to log, that is the question."><meta property="og:image" content="https://blog.stanleynguyen.me/post/when-to-log/img/shakespeare.jpg"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2020-06-14 13:13:55 +0000 UTC"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167295669-2"></script>
<script>if(navigator.doNotTrack!=="1"){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-167295669-2")}</script><link rel=icon type=image/x-icon class=js-site-favicon href=https://blog.stanleynguyen.me/%20favicon.ico><meta name=monetization content="$ilp.uphold.com/X2qLwibKrnFM"><style>figure{margin:1em 40px;display:flex;flex-direction:column;align-items:center}figcaption{margin-top:10px}figcaption p{color:#6a737d}</style></head><body><div style=position:relative><header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://blog.stanleynguyen.me/><svg class="octicon" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button onclick='document.querySelector("#header-search").style.display=document.querySelector("#header-search").style.display=="none"?"block":"none"'><svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button></div><div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=utf-8 method=get autocomplete=off><label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off>
<input type=hidden name=q value=site:https://blog.stanleynguyen.me/></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://blog.stanleynguyen.me/><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class=Header-item style=margin-right:0><a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></a></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://blog.stanleynguyen.me/><img class=avatar-user src=https://unavatar.now.sh/github/stanleynguyen width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://blog.stanleynguyen.me/>Stanley Nguyen</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://blog.stanleynguyen.me/post/when-to-log/>To log, or not to log, that is the question.</a></strong></h1><div class="note m-0">Created <relative-time datetime="Sun, 14 Jun 2020 13:13:55 +0000" class=no-wrap>Sun, 14 Jun 2020 13:13:55 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div class="file-header d-flex flex-md-items-center flex-items-start"><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1718 Words</div><div class="file-actions flex-order-2 pt-0"></div></div></div><div class="Box-body px-5 pb-5"><article class="markdown-body entry-content container-lg"><p>Logging is one of the those things are universally present in software projects with their different, unique forms (business & technical requirements) and flavors (technical stacks).
Logging is everywhere, from small 1-person-startups&rsquo; products to large enterprises&rsquo; systems, or even a simple algorithmic programming question where it&rsquo;s needed for checking outputs at implementation steps.
We are relying so much on log for develop, maintain, and keep our programs up and running, however, not much attention has been paid on how to design logging within our systems.
Often times, logging is treated as a second thought and only sprinkled into source code upon implementation like some magic powder that helps lighten the day-to-day operational abyss in our systems.</p><figure><img src=img/salt-logger.jpg width=600></figure><p>Just like how any pieces of code written will eventually become technical debts - a process that we can only slow down with great discipline, loggers rot at an unbelievable speed that after a while, we find ourselves fixing problems caused by loggers more often than loggers giving us information to debug our operational faults.
So how can we manage this mess called loggers and turn them into one of our allies rather than legacy ghosts hunting from past development mistakes?</p><h2 id=state-of-the-art>&ldquo;State of The Art&rdquo;</h2><p>Before I dive deeper into my solution proposal, let&rsquo;s define a concrete problem statement based on my observations.</p><p>So what exactly is logging? An interesting and on-point one-liner that I found from <a href=https://www.codeproject.com/Articles/42354/The-Art-of-Logging>Colin Eberhardt&rsquo;s article</a></p><blockquote><p>Logging is the process of recording application actions and state to a secondary interface.</p></blockquote><p>This is exactly how logging is weaved into systems. We all seem to subconciously agree with loggers not belonging to any layers of our systems but rather being application-wide and shared amongst different application components</p><figure><img src=img/stackoverflow-answer.png alt="A much approved answer on StackOverflow"><figcaption><p>A much approved answer on StackOverflow</p></figcaption></figure><p>A simple diagram where logging is fitted into a system that is designed with <a href=https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html>clean architecture</a> would look something like</p><p><img src=img/logging-arch.png alt="Logging in Clean Architecture"></p><p>We can safely say that logging itself is a subsystem within our application.
And that, without careful considerations, often spirals out of control faster than we think.
While designing logging to be a subsystem within our applications is not wrong, the traditional perception of logging (with 4 to 6 levels of <code>info</code>, <code>warn</code>, <code>error</code>, <code>debug</code>, etc.) often makes developers focus on the wrong thing - the format of our logs, rather than the actual purposes why we are writing logs.
This is the reason why we are logging errors out without thinking twice about how to handle them, why we are logging at every step of our code while ironically unable to debug effectively should there be a production issue.</p><p>This is why I am proposing an alternative thinking framework about logging and in turn, how we can design logging into our system reliably.</p><h2 id=the-good-the-bad-and-the-ugly>The Good, The Bad, and The Ugly</h2><p>This is a framework on how I think we should strategise our logging with three and only three categories / concerns for our logs.</p><h3 id=first-rule-of-logging-dont-log>First rule of logging: Don&rsquo;t log</h3><p>Overlogging is detrimental to our teams&rsquo; productivity and ability to handle business-as-usual operations. There&rsquo;re tons of reason why we should not &ldquo;log whenever you can&rdquo; as advised by some observability fanfare.
Just to name a few: logging means more code to maintain, logging incurs expense in terms of system performance, and more logging subject us to more data privacy regulatory audits.
If you need more reasons to refrain yourself from logging, check out <a href=https://sobolevn.me/2020/03/do-not-log>this post by Nikita Sobolev</a> or <a href=https://blog.codinghorror.com/the-problem-with-logging/>this post by Jeff Atwood</a>.</p><p>Nevertheless, I&rsquo;m not advising eliminating logs altogether.
I think logging, used correctly, can significantly help in keeping our system running reliably.
I&rsquo;m proposing we start without log and work our way up to identify places where we need to log, rather than &ldquo;log everywhere as we <strong>might possibly</strong> need to look at them&rdquo;.
My rule of thumb for adding a line of log is &ldquo;if we can&rsquo;t pin an exact reason or a scenario that we will look at the log content, <strong>don&rsquo;t log</strong>&rdquo;.</p><p>With that being said, how can we safely introduce log when it&rsquo;s absolutely necessary?
How should we structure our logs and format their content? What are the necessary information to include in logs?</p><h3 id=the-ugly>The Ugly</h3><p>This is the first type of logs that I want to describe, and they are also ones with the least frequency that I would expect (If we find it otherwise, we might have bigger issues in our systems!).
&ldquo;The Ugly&rdquo; is the kind of log under catastrophic or unexpected scenarios that require immediate action like catastrophic errors that need an application restart.
We can argue that, under these circumstances, it makes more sense to use alerting tools like Sentry.
Nevertheless, an error log might still be useful to provide ourselves with more contexts surrounding these errors which are not available in their stack trace but could help with reproducing these error like users&rsquo; inputs.
Just like the errors that they accompany, these logs should be kept to a minimum in our code and placed in a single location of the code.
They should also be designed/documented in the spec as a required system behavior for error handling, and weaved in source code next to where error handling happens.
While format and level for &ldquo;The Ugly&rdquo; logs are completely preferential on a team-by-team basis, I would recommend using <code>log.error</code> or <code>log.fatal</code> (before a graceful shutdown and restart of applications) attached with the full error stack trace and functions&rsquo; or requests&rsquo; input data for reproduction if necessary.</p><h3 id=the-bad>The Bad</h3><p>&ldquo;The Bad&rdquo; is the type of logs that addresses expected, handled errors like network issues, user inputs validation.
In the same manners as these expected errors, &ldquo;The Bad&rdquo; logs only require developers&rsquo; attention if there&rsquo;s an anomaly of occurrences
Together with a monitor set up to alert developers upon anomalies, these logs are handy to mitigate potential serious infrastructure or security problems.
This type of logs should be spec-ed inside error handling technical requirements as well, and can actually be bundled if we are handling expected and unexpected errors in the same code location.
Based on the nature of what they are making &ldquo;visible&rdquo; for developers, <code>log.warn</code> or <code>log.error</code> can be used for &ldquo;The Bad&rdquo; logs as teams&rsquo; convention.</p><h3 id=the-good>The Good</h3><p>Last but definitely not least, &ldquo;The Good&rdquo; is the type of logs that would appear most often in our source code while being the most difficult to get right.
&ldquo;The Good&rdquo; kind of logs are those associated with the &ldquo;happy&rdquo; steps of our applications, indicating the success of operations.
For its very nature of indicating starting/successful executions operations in our system, &ldquo;The Good&rdquo; is often abused by developers who are seduced by this mantra &ldquo;just one more bit of data in the log, we might need it&rdquo;.
Again, I would circle back to our very first rule of logging: &ldquo;Don&rsquo;t log unless you absolutely have to&rdquo;.
To prevent this abusive pattern from happening, we should document &ldquo;The Good&rdquo; as part of our technical requirements complementing the main business logics.
On top of that, for every single one of &ldquo;The Good&rdquo; logs to be inside our technical specs, it needs to pass the litmus test of whether there are any circumstances under which we would look at the log - be it a customer support request, an external auditor&rsquo;s inquiry.
Only this way, <code>log.info</code> won&rsquo;t be a dreaded legacy that obscure developers&rsquo; vision into our applications.</p><h3 id=the-rest-that-you-need-to-know>The Rest (that you need to know)</h3><p>By now I assume you would have noticed the general theme of my proposed logging strategy revolves around clear and specific documenting logs&rsquo; purposes.
It is important that we treat logging as part of our requirements, and be specific about what keywords, messages we want to tag in log context for them to be effectively indexed.
Only by doing that, we can be aware of each and every piece of logs that we produce, and in turn a clear vision into our systems.</p><p>As logs are upgraded to first-class citizens with concerete technical requirements inside our specs, the implications are that they would need to be:</p><ul><li>maintained and updated as the business and technical requirements evolves</li><li>covered by unit, integration test</li></ul><p>These might sound like a lot of extra work to get our logging right.
However, I argue that this is the kind of attention and effort logging deserve so it can be useful.</p><p><strong>Serve our logs, and we will be rewarded splendidly!</strong></p><h2 id=a-practical-migration-guide>A practical migration guide</h2><p>I reckon there&rsquo;s no use for a new logging strategy (or any new strategies/frameworks if that matters) for legacy projects if there&rsquo;s no way of moving them from their messy states to the proposed ideal.
Hence, I have a three-step general plan for anyone who are frustrated with their systems&rsquo; logs and willing to invest their time to log more effectively.</p><h3 id=identify-the-usual-suspects>Identify The Usual Suspects</h3><p>Since the idea is to reduce garbage logs, our first step is definitely identifying where the criminals are hiding.
With the powerful text editors and IDEs we have nowadays (or <code>grep</code> if you are reading this in the past through a window-to-the-future), all occurrences of logging can be easily identified.
A document (or spreadsheet if you would like to be organised) documenting all of these logging occurrences might be necessary if there are too many of them.</p><h3 id=convict-them-bad-actors>Convict them bad actors!</h3><p>After identifying all suspects, it&rsquo;s time to weed out the bad apples!
Logs which are duplicated, unreachable are low hanging fruits that we can immediately eliminate from our source code.
For the rest of our logging occurrences, it&rsquo;s time to involve other stakeholders like the &ldquo;inception&rdquo; engineer who started the project (if that is possible), product managers, customer supports, compliance folks to answer the question: Do we need each one of these logs, and if so, what is it being used for?</p><h3 id=light-at-the-end-of-the-tunnel>Light at the end of the tunnel</h3><p>Now that we have a narrowed-down list of absolutely necessary logs, turning them into technical requirements with documented purpose for each one of them (i.e. what to do when a <code>log.error</code> happen? who are we <code>log.info</code>-ing for?) is essential to nail down a contract (or we can call it specification) for our logging subsystem.
After this, it&rsquo;s just a matter of discipline, in the same manner as how we write and maintain software in general, to make our logging great again!</p></article></div></div></div></div></div></div></main></div><div class="footer container-xl width-full p-responsive"><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://blog.stanleynguyen.me/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2021. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a></li></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div></body><script type=application/javascript src=https://blog.stanleynguyen.me/js/github-style.js></script></html>