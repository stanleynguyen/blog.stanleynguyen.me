<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script type=application/javascript src=https://blog.stanleynguyen.me/js/theme-mode.js></script><link rel=stylesheet href=https://blog.stanleynguyen.me/css/frameworks.min.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/github.min.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/github-style.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/light.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/dark.css><link rel=stylesheet href=https://blog.stanleynguyen.me/css/syntax.css><title>Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast</title><link rel=icon type=image/x-icon href=https://blog.stanleynguyen.me/images/favicon.ico><meta name=theme-color content="#1e2327"><meta name=description content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta name=keywords content="dns,privacy,terminal,bash,network,nameserver"><meta name=robots content="noodp"><link rel=canonical href=https://blog.stanleynguyen.me/post/dns-command/><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta name=twitter:description content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta name=twitter:site content="https://blog.stanleynguyen.me/"><meta name=twitter:creator content="stanleynguyen"><meta name=twitter:image content="https://blog.stanleynguyen.me/posts/dns-command/img/cover.png"><meta property="og:type" content="article"><meta property="og:title" content="Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta property="og:description" content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta property="og:url" content="https://blog.stanleynguyen.me/post/dns-command/"><meta property="og:site_name" content="Quick terminal-based DNS switching"><meta property="og:image" content="https://blog.stanleynguyen.me/posts/dns-command/img/cover.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-10-19 14:53:23.322 +0000 UTC"><link rel=icon type=image/x-icon class=js-site-favicon href=https://blog.stanleynguyen.me/%20favicon.ico><meta name=monetization content="$ilp.uphold.com/X2qLwibKrnFM"><style>figure{margin:1em 40px;display:flex;flex-direction:column;align-items:center}figcaption{margin-top:10px}figcaption p{color:#6a737d}</style></head><body><div style=position:relative><header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://blog.stanleynguyen.me/><svg class="octicon" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button onclick="document.querySelector('#header-search').style.display=document.querySelector('#header-search').style.display=='none'?'block':'none'"><svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button></div><div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=utf-8 method=get autocomplete=off><label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off>
<input type=hidden name=q value=site:https://blog.stanleynguyen.me/></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://blog.stanleynguyen.me/><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class=Header-item style=margin-right:0><a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992 12.1153 2.12716 13.0615 3.89999 13.0615 5.89383 13.0615 9.29958 10.3006 12.0605 6.89485 12.0605c-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></a></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://blog.stanleynguyen.me/><img class=avatar-user src=https://unavatar.now.sh/github/stanleynguyen width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://blog.stanleynguyen.me/>Stanley Nguyen</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://blog.stanleynguyen.me/post/dns-command/>Quick terminal-based DNS switching</a></strong></h1><div class="note m-0">Created <relative-time datetime="Sat, 19 Oct 2019 14:53:23 +0000" class=no-wrap>Sat, 19 Oct 2019 14:53:23 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div class="file-header d-flex flex-md-items-center flex-items-start"><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1056 Words</div><div class="file-actions flex-order-2 pt-0"></div></div></div><div class="Box-body px-5 pb-5"><article class="markdown-body entry-content container-lg"><h3 id=motivation>Motivation</h3><p>Most of us, at some point of our lives, have used at least a custom DNS servers configurations for our computers.
Be it for avoiding censorship, faster browsing, security, or bypassing content restriction, we&rsquo;ve all tried setting our DNS servers to some public DNS servers like one from Google (remember 8.8.8.8 and 8.8.4.4?).
I myself is also no exception as I have been using <a href=https://1.1.1.1/dns/>1.1.1.1</a> for privacy and speed.
Unfortunately, having custom DNS nameservers also comes with some setbacks for someone who uses their computer all the time in all the different places.
With custom DNS servers, this is what you get on a network that tries to block them (together with VPN services etc.)</p><p><img src=/posts/dns-command/img/blocked.png alt="blocked by network"></p><p>Another problem that we would have with custom DNS servers is that networks&rsquo; login pages just don&rsquo;t show up as the default DNS is not being used to redirect us to local network login page.
Of course it would be easy to just remove the configurations as you (most likely) was the one who set them up, how hard would it be to remove?
But what if we need these alternate DNS servers again?
I personally find this way of manually removing and adding them back too much of a hassle.
Hence, I wrapped them in a bash function that does the job for me as all lazy programmers do.</p><h3 id=1111>1.1.1.1</h3><p>Before starting with explaining what I did in the next section, I would like to do a big shout-out to this awesome project that&rsquo;s a combined effort from <a href=https://www.cloudflare.com/>Cloudflare</a> and <a href=https://www.apnic.net/>APNIC</a> - <a href=https://1.1.1.1/dns/>1.1.1.1</a>.
It&rsquo;s an effort to provide Internet users with a faster and more secure DNS (it is more than 2x faster than Google Public DNS 🚀🚀🚀).
But more than just that, it is a <strong>privacy-first</strong> DNS server.
Did you think only these companies like Google, Facebook trying to track all of your activities online (which can be blocked with the awesome <a href=https://www.eff.org/privacybadger>Privacy Badger</a>)?
Your ISP also eavesdrops on whichever site you are visiting and sell these data to target you with ads, and they do it through, guess what, DNS resolvers!</p><p>1.1.1.1 protects you from all of that for a price of $0 (yes, you read that right).
A <strong>FREE</strong>, fast, secure DNS server that respects your privacy - sounds too good to be true, doesn&rsquo;t it? But it&rsquo;s an effort towards building a better Internet.
You don&rsquo;t have to take my words for that, read more about it on <a href=https://blog.cloudflare.com/announcing-1111/>Cloudflare&rsquo;s</a> and <a href="https://labs.apnic.net/?p=1127">APNIC&rsquo;s</a> blogs.</p><h3 id=switching-dns-nameservers-via-bash>Switching DNS nameservers via bash</h3><p>As I mentioned previously, it&rsquo;s too much of a hassle for me to go manually update my DNS configurations via Network Settings UI whenever I jump back and forth between school&rsquo;s and home&rsquo;s networks.
Naturally, I would try to figure out how to do it via my terminal.
That&rsquo;s when I found out about this awesome tool that comes in-built with macOS - <code>networksetup</code>.
With networksetup, changing my DNS config is as simple as</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Adding 1.1.1.1 to my nameservers</span>
networksetup -setdnsservers Wi-Fi 1.1.1.1
<span style=color:#75715e># Clear all my alternate nameservers</span>
networksetup -setdnsservers Wi-Fi empty
</code></pre></div><p>Now I can easily configure my DNS resolvers to be the same as the instructions for 1.1.1.1 by</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 4 nameservers - 2 IPv4 &amp; 2 IPv6</span>
networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
</code></pre></div><p>But this is quite lengthy to type as well, even though I would prefer this over Network Preferences UI any day. So I went another level of laziness by wrapping it inside a bash function</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
<span style=color:#f92672>}</span>
</code></pre></div><p>This seems to be pretty neat and does the job, but hold on a second. How about switching it back to empty?
A flag/argument to this bash function would do the job fine but I want to use the least effort as possible and save myself the mental burden of remembering whether my alternate DNS config is empty.
So I thought to myself: &ldquo;Why not detect the current state and switch the DNS config based on that? Like a literal switch button - you <strong>don&rsquo;t</strong> have to tell what state you want it to be, just the opposite of what comes before&rdquo;.
With that in mind, I found this option for networksetup that would tell me the current state</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>networksetup -getdnsservers Wi-Fi
</code></pre></div><p>It would list all of my alternate DNS servers, or print out this string <code>There aren't any DNS Servers set on Wi-Fi</code> if there isn&rsquo;t any.
And now I can complete my function, with some cool emojis to signify whether the config has just been applied or removed</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#66d9ef>$(</span>networksetup -getdnsservers Wi-Fi<span style=color:#66d9ef>)</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;There aren&#39;t any DNS Servers set on Wi-Fi&#34;</span>* <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001 <span style=color:#f92672>&amp;&amp;</span> echo 🚀 🚀 🚀
  <span style=color:#66d9ef>else</span>
    networksetup -setdnsservers Wi-Fi empty <span style=color:#f92672>&amp;&amp;</span> echo 🚦 🚦 🚦
  <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Now I can easily switch back and forth between 1.1.1.1 and default DNS configs with just a short command <code>dns1111</code></p><h3 id=bonus-linux-based-machine>Bonus: Linux based machine</h3><p>Since <code>networksetup</code> is not available not Linux based OSes, we would need to use a different package that helps handle DNS nameservers called <code>dnsmasq</code>.</p><p>Install it using your distro&rsquo;s package manager</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># this is for Ubuntu</span>
sudo apt-get install dnsmasq
</code></pre></div><p>Installing the package will come with a config file <code>/etc/dnsmasq.conf</code> for us to update the nameservers.
I have included my implementation below.
If you have a better approach, don&rsquo;t hesitate to reach out to me at <a href=mailto:hung.ngn.the@gmail.com>hung.ngn.the@gmail.com</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  <span style=color:#75715e># detect existence of the backup file to see whether the config is in place</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -f /etc/dnsmasq.conf.bak <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    sudo mv /etc/dnsmasq.conf.bak /etc/dnsmasq.conf <span style=color:#f92672>&amp;&amp;</span> echo 🚦 🚦 🚦
  <span style=color:#66d9ef>else</span>
    sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo echo -e <span style=color:#e6db74>&#34;server=1.1.1.1\nserver=1.0.0.1\nserver=2606:4700:4700::1111\nserver=2606:4700:4700::1001&#34;</span> &gt;&gt; /etc/dnsmasq.conf <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo systemctl restart dnsmasq  <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo systemctl restart NetworkManager  <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    echo 🚀 🚀 🚀
  <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Test</strong>
To do a lookup speed test choose a website that has not been visited since dnsmasq has been started (<code>drill</code> is part of the <code>ldns</code> package):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>
</code></pre></div><p>Running the command again will use the cached DNS IP and result in a faster lookup time if dnsmasq is setup correctly:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>

;; Query time: <span style=color:#ae81ff>18</span> msec

$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>

;; Query time: <span style=color:#ae81ff>2</span> msec
</code></pre></div></article></div></div></div></div></div></div></main></div><div class="footer container-xl width-full p-responsive"><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://blog.stanleynguyen.me/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a></li></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div></body><script type=application/javascript src=https://blog.stanleynguyen.me/js/github-style.js></script></html>