<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.stanleynguyen.me/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.stanleynguyen.me/css/github.css><meta name=viewport content="width=device-width"><meta name=description content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta name=keywords content="dns,privacy,terminal,bash,network,nameserver"><meta name=robots content="noodp"><link rel=canonical href=https://blog.stanleynguyen.me/posts/dns-command/><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta name=twitter:description content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta name=twitter:site content="https://blog.stanleynguyen.me/"><meta name=twitter:creator content="stanleynguyen"><meta name=twitter:image content="https://blog.stanleynguyen.me/posts/dns-command/img/cover.png"><meta property="og:type" content="article"><meta property="og:title" content="Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast"><meta property="og:description" content="A quick guide to switching DNS servers settings to tackle nameserver blocking &amp;amp; corporate proxy"><meta property="og:url" content="https://blog.stanleynguyen.me/posts/dns-command/"><meta property="og:site_name" content="Quick terminal-based DNS switching"><meta property="og:image" content="https://blog.stanleynguyen.me/posts/dns-command/img/cover.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-10-19 14:53:23.322 +0000 UTC"><title>Quick terminal-based DNS switching - Personal blog of Stanley Nguyen | software engineer & open-source enthusiast</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://blog.stanleynguyen.me/images/favicon.ico><meta name=theme-color content="#1e2327"><style>figure{margin:1em 40px;display:flex;flex-direction:column;align-items:center}figcaption{margin-top:10px}figcaption p{color:#6a737d}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-167295669-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://blog.stanleynguyen.me/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://blog.stanleynguyen.me/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src=https://unavatar.now.sh/github/stanleynguyen height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://blog.stanleynguyen.me/about/><img src=https://unavatar.now.sh/github/stanleynguyen width=26 height=26></a>
<span class=author><a href=https://blog.stanleynguyen.me/>Stanley Nguyen</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://blog.stanleynguyen.me/posts/dns-command/>Quick terminal-based DNS switching</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime=2019-10-19 class=no-wrap title="Created at 2019/10/19">2019-10-19</time-ago>
<span class=file-info-divider></span>Modified <time-ago datetime=2019-10-19 class=no-wrap title="Modified  at 2019/10/19">2019-10-19</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1056 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h3 id=motivation>Motivation</h3><p>Most of us, at some point of our lives, have used at least a custom DNS servers configurations for our computers.
Be it for avoiding censorship, faster browsing, security, or bypassing content restriction, we&rsquo;ve all tried setting our DNS servers to some public DNS servers like one from Google (remember 8.8.8.8 and 8.8.4.4?).
I myself is also no exception as I have been using <a href=https://1.1.1.1/dns/>1.1.1.1</a> for privacy and speed.
Unfortunately, having custom DNS nameservers also comes with some setbacks for someone who uses their computer all the time in all the different places.
With custom DNS servers, this is what you get on a network that tries to block them (together with VPN services etc.)</p><p><img src=/posts/dns-command/img/blocked.png alt="blocked by network"></p><p>Another problem that we would have with custom DNS servers is that networks&rsquo; login pages just don&rsquo;t show up as the default DNS is not being used to redirect us to local network login page.
Of course it would be easy to just remove the configurations as you (most likely) was the one who set them up, how hard would it be to remove?
But what if we need these alternate DNS servers again?
I personally find this way of manually removing and adding them back too much of a hassle.
Hence, I wrapped them in a bash function that does the job for me as all lazy programmers do.</p><h3 id=1111>1.1.1.1</h3><p>Before starting with explaining what I did in the next section, I would like to do a big shout-out to this awesome project that&rsquo;s a combined effort from <a href=https://www.cloudflare.com/>Cloudflare</a> and <a href=https://www.apnic.net/>APNIC</a> - <a href=https://1.1.1.1/dns/>1.1.1.1</a>.
It&rsquo;s an effort to provide Internet users with a faster and more secure DNS (it is more than 2x faster than Google Public DNS ðŸš€ðŸš€ðŸš€).
But more than just that, it is a <strong>privacy-first</strong> DNS server.
Did you think only these companies like Google, Facebook trying to track all of your activities online (which can be blocked with the awesome <a href=https://www.eff.org/privacybadger>Privacy Badger</a>)?
Your ISP also eavesdrops on whichever site you are visiting and sell these data to target you with ads, and they do it through, guess what, DNS resolvers!</p><p>1.1.1.1 protects you from all of that for a price of $0 (yes, you read that right).
A <strong>FREE</strong>, fast, secure DNS server that respects your privacy - sounds too good to be true, doesn&rsquo;t it? But it&rsquo;s an effort towards building a better Internet.
You don&rsquo;t have to take my words for that, read more about it on <a href=https://blog.cloudflare.com/announcing-1111/>Cloudflare&rsquo;s</a> and <a href="https://labs.apnic.net/?p=1127">APNIC&rsquo;s</a> blogs.</p><h3 id=switching-dns-nameservers-via-bash>Switching DNS nameservers via bash</h3><p>As I mentioned previously, it&rsquo;s too much of a hassle for me to go manually update my DNS configurations via Network Settings UI whenever I jump back and forth between school&rsquo;s and home&rsquo;s networks.
Naturally, I would try to figure out how to do it via my terminal.
That&rsquo;s when I found out about this awesome tool that comes in-built with macOS - <code>networksetup</code>.
With networksetup, changing my DNS config is as simple as</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Adding 1.1.1.1 to my nameservers</span>
networksetup -setdnsservers Wi-Fi 1.1.1.1
<span style=color:#75715e># Clear all my alternate nameservers</span>
networksetup -setdnsservers Wi-Fi empty
</code></pre></div><p>Now I can easily configure my DNS resolvers to be the same as the instructions for 1.1.1.1 by</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 4 nameservers - 2 IPv4 &amp; 2 IPv6</span>
networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
</code></pre></div><p>But this is quite lengthy to type as well, even though I would prefer this over Network Preferences UI any day. So I went another level of laziness by wrapping it inside a bash function</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
<span style=color:#f92672>}</span>
</code></pre></div><p>This seems to be pretty neat and does the job, but hold on a second. How about switching it back to empty?
A flag/argument to this bash function would do the job fine but I want to use the least effort as possible and save myself the mental burden of remembering whether my alternate DNS config is empty.
So I thought to myself: &ldquo;Why not detect the current state and switch the DNS config based on that? Like a literal switch button - you <strong>don&rsquo;t</strong> have to tell what state you want it to be, just the opposite of what comes before&rdquo;.
With that in mind, I found this option for networksetup that would tell me the current state</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>networksetup -getdnsservers Wi-Fi
</code></pre></div><p>It would list all of my alternate DNS servers, or print out this string <code>There aren't any DNS Servers set on Wi-Fi</code> if there isn&rsquo;t any.
And now I can complete my function, with some cool emojis to signify whether the config has just been applied or removed</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#66d9ef>$(</span>networksetup -getdnsservers Wi-Fi<span style=color:#66d9ef>)</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;There aren&#39;t any DNS Servers set on Wi-Fi&#34;</span>* <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001 <span style=color:#f92672>&amp;&amp;</span> echo ðŸš€ ðŸš€ ðŸš€
  <span style=color:#66d9ef>else</span>
    networksetup -setdnsservers Wi-Fi empty <span style=color:#f92672>&amp;&amp;</span> echo ðŸš¦ ðŸš¦ ðŸš¦
  <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Now I can easily switch back and forth between 1.1.1.1 and default DNS configs with just a short command <code>dns1111</code></p><h3 id=bonus-linux-based-machine>Bonus: Linux based machine</h3><p>Since <code>networksetup</code> is not available not Linux based OSes, we would need to use a different package that helps handle DNS nameservers called <code>dnsmasq</code>.</p><p>Install it using your distro&rsquo;s package manager</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># this is for Ubuntu</span>
sudo apt-get install dnsmasq
</code></pre></div><p>Installing the package will come with a config file <code>/etc/dnsmasq.conf</code> for us to update the nameservers.
I have included my implementation below.
If you have a better approach, don&rsquo;t hesitate to reach out to me at <a href=mailto:hung.ngn.the@gmail.com>hung.ngn.the@gmail.com</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>function</span> dns1111<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  <span style=color:#75715e># detect existence of the backup file to see whether the config is in place</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -f /etc/dnsmasq.conf.bak <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    sudo mv /etc/dnsmasq.conf.bak /etc/dnsmasq.conf <span style=color:#f92672>&amp;&amp;</span> echo ðŸš¦ ðŸš¦ ðŸš¦
  <span style=color:#66d9ef>else</span>
    sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo echo -e <span style=color:#e6db74>&#34;server=1.1.1.1\nserver=1.0.0.1\nserver=2606:4700:4700::1111\nserver=2606:4700:4700::1001&#34;</span> &gt;&gt; /etc/dnsmasq.conf <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo systemctl restart dnsmasq  <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    sudo systemctl restart NetworkManager  <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    echo ðŸš€ ðŸš€ ðŸš€
  <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Test</strong>
To do a lookup speed test choose a website that has not been visited since dnsmasq has been started (<code>drill</code> is part of the <code>ldns</code> package):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>
</code></pre></div><p>Running the command again will use the cached DNS IP and result in a faster lookup time if dnsmasq is setup correctly:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>

;; Query time: <span style=color:#ae81ff>18</span> msec

$ drill archlinux.org | grep <span style=color:#e6db74>&#34;Query time&#34;</span>

;; Query time: <span style=color:#ae81ff>2</span> msec
</code></pre></div></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">Â© 2020. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a></a></li></ul><a aria-label=Homepage title="Personal blog of Stanley Nguyen | software engineer & open-source enthusiast" class="footer-octicon d-none d-lg-block mx-lg-4" href=https://blog.stanleynguyen.me/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://blog.stanleynguyen.me/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://blog.stanleynguyen.me/js/github-bootstrap.js></script><script src=https://blog.stanleynguyen.me/js/stop.js></script><script src=https://blog.stanleynguyen.me/js/contributions.js></script></body></html>